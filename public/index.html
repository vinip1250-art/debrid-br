<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Brazuca Wrapper</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  :root {
    --bg: #050816;
    --card: #111827;
    --text: #e5e7eb;
    --input-bg: #020617;
    --border: #374151;
    --accent: #2563eb;
    --warning-bg: #7f1d1d;
    --warning-text: #fecaca;
  }

  .light {
    --bg: #f3f4f6;
    --card: #ffffff;
    --text: #111827;
    --input-bg: #f9fafb;
    --border: #d1d5db;
    --accent: #2563eb;
    --warning-bg: #fee2e2;
    --warning-text: #7f1d1d;
  }

  body {
    font-family: system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    transition: 0.3s;
  }

  .card {
    background: var(--card);
    padding: 24px 28px;
    border-radius: 12px;
    max-width: 520px;
    width: 100%;
    box-shadow: 0 0 20px #00000055;
    transition: 0.3s;
  }

  h1 {
    margin: 0 0 12px;
    font-size: 1.6rem;
    text-align: center;
  }

  label {
    display: block;
    margin-top: 12px;
    font-size: 0.9rem;
  }

  input[type="text"], select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--input-bg);
    color: var(--text);
    margin-top: 4px;
    transition: 0.3s;
  }

  .check-row {
    margin-top: 14px;
    display: flex;
    gap: 12px;
    align-items: center;
  }

  button {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    background: var(--accent);
    color: white;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.2s;
  }

  button:hover:not(:disabled) {
    filter: brightness(1.15);
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .warning {
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    background: var(--warning-bg);
    color: var(--warning-text);
    font-size: 0.85rem;
    display: none;
  }

  .debrid-box {
    margin-top: 12px;
    padding: 12px;
    border-radius: 8px;
    background: var(--input-bg);
    border: 1px solid var(--border);
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.3s forwards;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .toggle {
    text-align: right;
    margin-bottom: 10px;
  }

  .toggle button {
    width: auto;
    padding: 6px 12px;
    font-size: 0.8rem;
  }

  .icon {
    width: 18px;
    vertical-align: middle;
    margin-right: 6px;
  }

  .link-box {
    margin-top: 10px;
    padding: 8px 10px;
    border-radius: 8px;
    background: var(--input-bg);
    border: 1px solid var(--border);
    font-size: 0.8rem;
    word-break: break-word;
  }
</style>
</head>

<body>
<div class="card">

  <div class="toggle">
    <button onclick="toggleTheme()">Alternar Tema</button>
  </div>

  <h1>Brazuca Wrapper</h1>

  <label>Nome do Addon</label>
  <input type="text" id="nomeAddon" value="Brazuca Debrid" />

  <label>√çcone (URL)</label>
  <input type="text" id="iconeUrl" value="https://i.imgur.com/KVpfrAk.png" />

  <div class="check-row">
    <input type="checkbox" id="cometCheck" checked />
    <label for="cometCheck">Ativar Comet</label>
  </div>

  <div class="check-row">
    <input type="checkbox" id="torrentioCheck" checked />
    <label for="torrentioCheck">Ativar Torrentio</label>
  </div>

  <label>Selecione at√© 2 servi√ßos Debrid</label>
  <select id="debridSelect" multiple size="5">
    <option value="torbox">üîµ TorBox</option>
    <option value="realdebrid">üü° Real‚ÄëDebrid</option>
    <option value="premiumize">üü£ Premiumize</option>
    <option value="debridlink">üü¢ Debrid‚ÄëLink</option>
    <option value="alldebrid">üî¥ AllDebrid</option>
  </select>

  <div class="warning" id="warningDebrid">
    Voc√™ s√≥ pode selecionar at√© 2 servi√ßos Debrid.
  </div>

  <div id="debridFields"></div>

  <div class="warning" id="warningApi">
    Preencha ao menos uma API key para gerar a configura√ß√£o.
  </div>

  <button id="gerarBtn" onclick="gerarConfiguracao()" disabled>
    Gerar Configura√ß√£o
  </button>

  <div class="link-box" id="linkBox">O link do manifest aparecer√° aqui.</div>

  <button onclick="copiarLink()" id="copyBtn" style="display:none;">
    Copiar Link do Manifest
  </button>

</div>

<script>
  let ultimoLink = "";

  function toggleTheme() {
    document.body.classList.toggle("light");
  }

  const debridInfo = {
    torbox: {
      label: "TorBox API Key",
      ref: `
        <button onclick="abrirTorbox()">Assinar TorBox (7 dias gr√°tis)</button>
        <button onclick="copiarTorbox()">Copiar c√≥digo TorBox</button>
      `
    },
    realdebrid: {
      label: "Real‚ÄëDebrid API Key",
      ref: `<button onclick="abrirRD()">Criar conta / Assinar Real‚ÄëDebrid</button>`
    },
    premiumize: { label: "Premiumize API Key", ref: "" },
    debridlink: { label: "Debrid‚ÄëLink API Key", ref: "" },
    alldebrid: { label: "AllDebrid API Key", ref: "" }
  };

  document.getElementById("debridSelect").addEventListener("change", atualizarDebrid);

  function atualizarDebrid() {
    const select = document.getElementById("debridSelect");
    const aviso = document.getElementById("warningDebrid");
    const selecionados = [...select.selectedOptions].map(o => o.value);

    if (selecionados.length > 2) {
      aviso.style.display = "block";
      [...select.options].forEach(opt => opt.selected = false);
      document.getElementById("debridFields").innerHTML = "";
      validarApis();
      return;
    }

    aviso.style.display = "none";

    const container = document.getElementById("debridFields");
    container.innerHTML = "";

    selecionados.forEach(servico => {
      const info = debridInfo[servico];

      container.innerHTML += `
        <div class="debrid-box">
          <label>${info.label}</label>
          <input type="text" id="${servico}Key" placeholder="Cole sua chave ${servico}">
          ${info.ref}
        </div>
      `;
    });

    selecionados.forEach(servico => {
      document.getElementById(servico + "Key").addEventListener("input", validarApis);
    });

    validarApis();
  }

  function validarApis() {
    const selecionados = [...document.getElementById("debridSelect").selectedOptions].map(o => o.value);

    const temKey = selecionados.some(s => {
      const campo = document.getElementById(s + "Key");
      return campo && campo.value.trim() !== "";
    });

    const aviso = document.getElementById("warningApi");
    const botao = document.getElementById("gerarBtn");

    botao.disabled = !temKey;
    aviso.style.display = temKey ? "none" : "block";
  }

  async function gerarConfiguracao() {
    const selecionados = [...document.getElementById("debridSelect").selectedOptions].map(o => o.value);

    const config = {
      nome: document.getElementById("nomeAddon").value,
      icone: document.getElementById("iconeUrl").value,
      debrids: selecionados,
      cometa: document.getElementById("cometCheck").checked,
      torrentio: document.getElementById("torrentioCheck").checked
    };

    selecionados.forEach(s => {
      config[s] = document.getElementById(s + "Key").value;
    });

    try {
      const res = await fetch("/gerar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(config)
      });

      const data = await res.json();
      ultimoLink = `${window.location.origin}/${data.id}/manifest.json`;

      document.getElementById("linkBox").textContent = ultimoLink;
      document.getElementById("copyBtn").style.display = "block";
    } catch {
      document.getElementById("linkBox").textContent = "Erro ao gerar configura√ß√£o.";
    }
  }

  function copiarLink() {
    navigator.clipboard.writeText(ultimoLink);
    alert("Link copiado!");
  }

  function copiarTorbox() {
    navigator.clipboard.writeText("b08bcd10-8df2-44c9-a0ba-4d5bdb62ef96");
    alert("C√≥digo TorBox copiado!");
  }

  function abrirTorbox() {
    window.open("https://torbox.app/subscription?referral=b08bcd10-8df2-44c9-a0ba-4d5bdb62ef96", "_blank");
  }

  function abrirRD() {
    window.open("https://real-debrid.com/?id=6684575", "_blank");
  }
</script>

</body>
</html>
